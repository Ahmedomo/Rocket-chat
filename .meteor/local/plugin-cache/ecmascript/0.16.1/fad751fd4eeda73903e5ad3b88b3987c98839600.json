{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/weslley/Documents/projects/Rocket.Chat/app/api/server/lib/rooms.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"app/api/server/lib/rooms.js","filename":"/home/weslley/Documents/projects/Rocket.Chat/app/api/server/lib/rooms.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/weslley/Documents/projects/Rocket.Chat","root":"/home/weslley/Documents/projects/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/weslley/Documents/projects/Rocket.Chat/app/api/server/lib/rooms.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/api/server/lib/rooms.js"}},"code":"module.export({\n  findAdminRooms: () => findAdminRooms,\n  findAdminRoom: () => findAdminRoom,\n  findChannelAndPrivateAutocomplete: () => findChannelAndPrivateAutocomplete,\n  findAdminRoomsAutocomplete: () => findAdminRoomsAutocomplete,\n  findChannelAndPrivateAutocompleteWithPagination: () => findChannelAndPrivateAutocompleteWithPagination,\n  findRoomsAvailableForTeams: () => findRoomsAvailableForTeams\n});\nlet hasPermissionAsync, hasAtLeastOnePermissionAsync;\nmodule.link(\"../../../authorization/server/functions/hasPermission\", {\n  hasPermissionAsync(v) {\n    hasPermissionAsync = v;\n  },\n\n  hasAtLeastOnePermissionAsync(v) {\n    hasAtLeastOnePermissionAsync = v;\n  }\n\n}, 0);\nlet Rooms;\nmodule.link(\"../../../models/server/raw\", {\n  Rooms(v) {\n    Rooms = v;\n  }\n\n}, 1);\nlet Subscriptions;\nmodule.link(\"../../../models/server\", {\n  Subscriptions(v) {\n    Subscriptions = v;\n  }\n\n}, 2);\nlet adminFields;\nmodule.link(\"../../../../lib/rooms/adminFields\", {\n  adminFields(v) {\n    adminFields = v;\n  }\n\n}, 3);\n\nfunction findAdminRooms(_ref) {\n  return Promise.asyncApply(() => {\n    let {\n      uid,\n      filter,\n      types = [],\n      pagination: {\n        offset,\n        count,\n        sort\n      }\n    } = _ref;\n\n    if (!Promise.await(hasPermissionAsync(uid, 'view-room-administration'))) {\n      throw new Error('error-not-authorized');\n    }\n\n    const name = filter && filter.trim();\n    const discussion = types && types.includes('discussions');\n    const includeTeams = types && types.includes('teams');\n    const showOnlyTeams = types.length === 1 && types.includes('teams');\n    const typesToRemove = ['discussions', 'teams'];\n    const showTypes = Array.isArray(types) ? types.filter(type => !typesToRemove.includes(type)) : [];\n    const options = {\n      fields: adminFields,\n      sort: sort || {\n        default: -1,\n        name: 1\n      },\n      skip: offset,\n      limit: count\n    };\n    let cursor;\n\n    if (name && showTypes.length) {\n      cursor = Rooms.findByNameContainingAndTypes(name, showTypes, discussion, includeTeams, showOnlyTeams, options);\n    } else if (showTypes.length) {\n      cursor = Rooms.findByTypes(showTypes, discussion, includeTeams, showOnlyTeams, options);\n    } else {\n      cursor = Rooms.findByNameContaining(name, discussion, includeTeams, showOnlyTeams, options);\n    }\n\n    const total = Promise.await(cursor.count());\n    const rooms = Promise.await(cursor.toArray());\n    return {\n      rooms,\n      count: rooms.length,\n      offset,\n      total\n    };\n  });\n}\n\nfunction findAdminRoom(_ref2) {\n  return Promise.asyncApply(() => {\n    let {\n      uid,\n      rid\n    } = _ref2;\n\n    if (!Promise.await(hasPermissionAsync(uid, 'view-room-administration'))) {\n      throw new Error('error-not-authorized');\n    }\n\n    return Rooms.findOneById(rid, {\n      fields: adminFields\n    });\n  });\n}\n\nfunction findChannelAndPrivateAutocomplete(_ref3) {\n  return Promise.asyncApply(() => {\n    let {\n      uid,\n      selector\n    } = _ref3;\n    const options = {\n      fields: {\n        _id: 1,\n        fname: 1,\n        name: 1,\n        t: 1,\n        avatarETag: 1\n      },\n      limit: 10,\n      sort: {\n        name: 1\n      }\n    };\n    const userRoomsIds = Subscriptions.cachedFindByUserId(uid, {\n      fields: {\n        rid: 1\n      }\n    }).fetch().map(item => item.rid);\n    const rooms = Promise.await(Rooms.findRoomsWithoutDiscussionsByRoomIds(selector.name, userRoomsIds, options).toArray());\n    return {\n      items: rooms\n    };\n  });\n}\n\nfunction findAdminRoomsAutocomplete(_ref4) {\n  return Promise.asyncApply(() => {\n    let {\n      uid,\n      selector\n    } = _ref4;\n\n    if (!Promise.await(hasAtLeastOnePermissionAsync(uid, ['view-room-administration', 'can-audit']))) {\n      throw new Error('error-not-authorized');\n    }\n\n    const options = {\n      fields: {\n        _id: 1,\n        fname: 1,\n        name: 1,\n        t: 1,\n        avatarETag: 1\n      },\n      limit: 10,\n      sort: {\n        name: 1\n      }\n    };\n    const rooms = Promise.await(Rooms.findRoomsByNameOrFnameStarting(selector.name, options).toArray());\n    return {\n      items: rooms\n    };\n  });\n}\n\nfunction findChannelAndPrivateAutocompleteWithPagination(_ref5) {\n  return Promise.asyncApply(() => {\n    let {\n      uid,\n      selector,\n      pagination: {\n        offset,\n        count,\n        sort\n      }\n    } = _ref5;\n    const userRoomsIds = Subscriptions.cachedFindByUserId(uid, {\n      fields: {\n        rid: 1\n      }\n    }).fetch().map(item => item.rid);\n    const options = {\n      fields: {\n        _id: 1,\n        fname: 1,\n        name: 1,\n        t: 1,\n        avatarETag: 1\n      },\n      sort: sort || {\n        name: 1\n      },\n      skip: offset,\n      limit: count\n    };\n    const cursor = Promise.await(Rooms.findRoomsWithoutDiscussionsByRoomIds(selector.name, userRoomsIds, options));\n    const total = Promise.await(cursor.count());\n    const rooms = Promise.await(cursor.toArray());\n    return {\n      items: rooms,\n      total\n    };\n  });\n}\n\nfunction findRoomsAvailableForTeams(_ref6) {\n  return Promise.asyncApply(() => {\n    let {\n      uid,\n      name\n    } = _ref6;\n    const options = {\n      fields: {\n        _id: 1,\n        fname: 1,\n        name: 1,\n        t: 1,\n        avatarETag: 1\n      },\n      limit: 10,\n      sort: {\n        name: 1\n      }\n    };\n    const userRooms = Subscriptions.findByUserIdAndRoles(uid, ['owner'], {\n      fields: {\n        rid: 1\n      }\n    }).fetch().map(item => item.rid);\n    const rooms = Promise.await(Rooms.findChannelAndGroupListWithoutTeamsByNameStartingByOwner(uid, name, userRooms, options).toArray());\n    return {\n      items: rooms\n    };\n  });\n}","map":{"version":3,"sources":["app/api/server/lib/rooms.js"],"names":["module","export","findAdminRooms","findAdminRoom","findChannelAndPrivateAutocomplete","findAdminRoomsAutocomplete","findChannelAndPrivateAutocompleteWithPagination","findRoomsAvailableForTeams","hasPermissionAsync","hasAtLeastOnePermissionAsync","link","v","Rooms","Subscriptions","adminFields","uid","filter","types","pagination","offset","count","sort","Error","name","trim","discussion","includes","includeTeams","showOnlyTeams","length","typesToRemove","showTypes","Array","isArray","type","options","fields","default","skip","limit","cursor","findByNameContainingAndTypes","findByTypes","findByNameContaining","total","rooms","toArray","rid","findOneById","selector","_id","fname","t","avatarETag","userRoomsIds","cachedFindByUserId","fetch","map","item","findRoomsWithoutDiscussionsByRoomIds","items","findRoomsByNameOrFnameStarting","userRooms","findByUserIdAndRoles","findChannelAndGroupListWithoutTeamsByNameStartingByOwner"],"mappings":"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","sourcesContent":["import { hasPermissionAsync, hasAtLeastOnePermissionAsync } from '../../../authorization/server/functions/hasPermission';\nimport { Rooms } from '../../../models/server/raw';\nimport { Subscriptions } from '../../../models/server';\nimport { adminFields } from '../../../../lib/rooms/adminFields';\n\nexport async function findAdminRooms({ uid, filter, types = [], pagination: { offset, count, sort } }) {\n\tif (!(await hasPermissionAsync(uid, 'view-room-administration'))) {\n\t\tthrow new Error('error-not-authorized');\n\t}\n\tconst name = filter && filter.trim();\n\tconst discussion = types && types.includes('discussions');\n\tconst includeTeams = types && types.includes('teams');\n\tconst showOnlyTeams = types.length === 1 && types.includes('teams');\n\tconst typesToRemove = ['discussions', 'teams'];\n\tconst showTypes = Array.isArray(types) ? types.filter((type) => !typesToRemove.includes(type)) : [];\n\tconst options = {\n\t\tfields: adminFields,\n\t\tsort: sort || { default: -1, name: 1 },\n\t\tskip: offset,\n\t\tlimit: count,\n\t};\n\n\tlet cursor;\n\tif (name && showTypes.length) {\n\t\tcursor = Rooms.findByNameContainingAndTypes(name, showTypes, discussion, includeTeams, showOnlyTeams, options);\n\t} else if (showTypes.length) {\n\t\tcursor = Rooms.findByTypes(showTypes, discussion, includeTeams, showOnlyTeams, options);\n\t} else {\n\t\tcursor = Rooms.findByNameContaining(name, discussion, includeTeams, showOnlyTeams, options);\n\t}\n\n\tconst total = await cursor.count();\n\n\tconst rooms = await cursor.toArray();\n\n\treturn {\n\t\trooms,\n\t\tcount: rooms.length,\n\t\toffset,\n\t\ttotal,\n\t};\n}\n\nexport async function findAdminRoom({ uid, rid }) {\n\tif (!(await hasPermissionAsync(uid, 'view-room-administration'))) {\n\t\tthrow new Error('error-not-authorized');\n\t}\n\n\treturn Rooms.findOneById(rid, { fields: adminFields });\n}\n\nexport async function findChannelAndPrivateAutocomplete({ uid, selector }) {\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tfname: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tavatarETag: 1,\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t};\n\n\tconst userRoomsIds = Subscriptions.cachedFindByUserId(uid, { fields: { rid: 1 } })\n\t\t.fetch()\n\t\t.map((item) => item.rid);\n\n\tconst rooms = await Rooms.findRoomsWithoutDiscussionsByRoomIds(selector.name, userRoomsIds, options).toArray();\n\n\treturn {\n\t\titems: rooms,\n\t};\n}\n\nexport async function findAdminRoomsAutocomplete({ uid, selector }) {\n\tif (!(await hasAtLeastOnePermissionAsync(uid, ['view-room-administration', 'can-audit']))) {\n\t\tthrow new Error('error-not-authorized');\n\t}\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tfname: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tavatarETag: 1,\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t};\n\n\tconst rooms = await Rooms.findRoomsByNameOrFnameStarting(selector.name, options).toArray();\n\n\treturn {\n\t\titems: rooms,\n\t};\n}\n\nexport async function findChannelAndPrivateAutocompleteWithPagination({ uid, selector, pagination: { offset, count, sort } }) {\n\tconst userRoomsIds = Subscriptions.cachedFindByUserId(uid, { fields: { rid: 1 } })\n\t\t.fetch()\n\t\t.map((item) => item.rid);\n\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tfname: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tavatarETag: 1,\n\t\t},\n\t\tsort: sort || { name: 1 },\n\t\tskip: offset,\n\t\tlimit: count,\n\t};\n\n\tconst cursor = await Rooms.findRoomsWithoutDiscussionsByRoomIds(selector.name, userRoomsIds, options);\n\n\tconst total = await cursor.count();\n\tconst rooms = await cursor.toArray();\n\n\treturn {\n\t\titems: rooms,\n\t\ttotal,\n\t};\n}\n\nexport async function findRoomsAvailableForTeams({ uid, name }) {\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tfname: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tavatarETag: 1,\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t};\n\n\tconst userRooms = Subscriptions.findByUserIdAndRoles(uid, ['owner'], { fields: { rid: 1 } })\n\t\t.fetch()\n\t\t.map((item) => item.rid);\n\n\tconst rooms = await Rooms.findChannelAndGroupListWithoutTeamsByNameStartingByOwner(uid, name, userRooms, options).toArray();\n\n\treturn {\n\t\titems: rooms,\n\t};\n}\n"]},"sourceType":"module","hash":"fad751fd4eeda73903e5ad3b88b3987c98839600"}
